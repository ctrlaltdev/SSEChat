FROM __BASEIMAGE_ARCH__/alpine:latest

LABEL name='SSEChat'
LABEL version='1.0'
LABEL description="Ephemeral Chat on SSE"
LABEL org.ctrlaltdev.vendor='ctrlaltdev'

__CROSS_COPY qemu-__QEMU_ARCH__-static /usr/bin/

ARG PORT=1337

RUN set -x && apk --no-cache add python3 supervisor nodejs npm

RUN mkdir /opt/chat
COPY ./ /opt/chat
WORKDIR /opt/chat
RUN npm ci
RUN npm run build

EXPOSE 1337

ENTRYPOINT [ "/opt/chat/entrypoint.sh" ]
